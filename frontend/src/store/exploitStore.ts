import { create } from 'zustand';

export interface ShellSession {
  id: string;
  target_ip: string;
  target_port: number;
  status: 'connecting' | 'connected' | 'disconnected' | 'failed';
  type: 'reverse' | 'bind';
  created_at: Date;
  commands_executed: number;
  uptime: number;
}

interface ExploitState {
  sessions: ShellSession[];
  activeSessionId: string | null;
  addSession: (session: ShellSession) => void;
  removeSession: (id: string) => void;
  setActiveSession: (id: string | null) => void;
  updateSessionStatus: (id: string, status: ShellSession['status']) => void;
  incrementCommandCount: (id: string) => void;
  getActiveSessionCount: () => number;
  hasActiveSessions: () => boolean;
}

export const useExploitStore = create<ExploitState>((set, get) => ({
  sessions: [],
  activeSessionId: null,
  
  addSession: (session) => set((state) => ({
    sessions: [...state.sessions, session],
    activeSessionId: session.id
  })),
  
  removeSession: (id) => set((state) => ({
    sessions: state.sessions.filter(s => s.id !== id),
    activeSessionId: state.activeSessionId === id ? null : state.activeSessionId
  })),
  
  setActiveSession: (id) => set({ activeSessionId: id }),
  
  updateSessionStatus: (id, status) => set((state) => ({
    sessions: state.sessions.map(s => 
      s.id === id ? { ...s, status } : s
    )
  })),
  
  incrementCommandCount: (id) => set((state) => ({
    sessions: state.sessions.map(s => 
      s.id === id ? { ...s, commands_executed: s.commands_executed + 1 } : s
    )
  })),
  
  getActiveSessionCount: () => {
    const state = get();
    return state.sessions.filter(s => s.status === 'connected' || s.status === 'connecting').length;
  },
  
  hasActiveSessions: () => {
    const state = get();
    return state.sessions.some(s => s.status === 'connected' || s.status === 'connecting');
  }
}));
