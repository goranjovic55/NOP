#!/bin/bash
# Quick check of what changed on target after exploitation

echo "=== Metasploitable2 Post-Exploitation Analysis ==="
echo "Date: $(date)"
echo ""

docker exec metasploitable2 bash -c '
echo "1. Last Login Attempts (last 10):"
last -10 2>/dev/null || echo "No login records"
echo ""

echo "2. Current User Sessions:"
who 2>/dev/null || echo "No active sessions"
echo ""

echo "3. Recent Auth Log (last 20 lines):"
tail -20 /var/log/auth.log 2>/dev/null | grep -v "CRON" || echo "No auth logs"
echo ""

echo "4. Network Connections:"
netstat -tnpa 2>/dev/null | grep ESTABLISHED | grep -v "127.0.0.1" || echo "No external connections"
echo ""

echo "5. Files modified in last 5 minutes:"
find /root /home -type f -mmin -5 2>/dev/null | head -20 || echo "No recent changes"
echo ""

echo "6. Command History (last 20):"
tail -20 /root/.bash_history 2>/dev/null || echo "No history"
'
